/*! For license information please see addon-entry-mediarecorder.js.LICENSE */
(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([["addon-entry-mediarecorder"],{"./node_modules/css-loader/index.js!./src/addons/addons/mediarecorder/style.css":function(e,t,n){(e.exports=n("./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopupContent {\n  padding: 1.5rem 2.25rem;\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 0.5rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\np.mediaRecorderPopupOption {\n  display: flex;\n  align-items: center;\n}\n\n.mediaRecorderPopupOption input[type="checkbox"] {\n  height: 1.5rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n/* TW: Fixes cancel button in dark mode */\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},"./src/addons/addons/mediarecorder/_runtime_entry.js":function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return d}));var o=n("./src/addons/addons/mediarecorder/userscript.js"),a=n("./node_modules/css-loader/index.js!./src/addons/addons/mediarecorder/style.css"),r=n.n(a);const d={"userscript.js":o.default,"style.css":r.a}},"./src/addons/addons/mediarecorder/userscript.js":function(e,t,n){"use strict";n.r(t);var o=n("./src/addons/libraries/common/cs/download-blob.js");t.default=async e=>{let t,n,a,{addon:r,console:d,msg:c}=e,i=!1,s=!1,l=null,p=null,m=null,u=[];for(;;){const e=await r.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),b=()=>{const{backdrop:e,container:t,content:n,closeButton:o,remove:a}=r.tab.createModal(c("option-title"),{isOpen:!0,useEditorClasses:!0});t.classList.add("mediaRecorderPopup"),n.classList.add("mediaRecorderPopupContent"),n.appendChild(Object.assign(document.createElement("p"),{textContent:c("record-description"),className:"recordOptionDescription"}));const d=document.createElement("p"),i=Object.assign(document.createElement("input"),{type:"number",min:1,max:300,defaultValue:30,id:"recordOptionSecondsInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),s=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:c("record-duration")});d.appendChild(s),d.appendChild(i),n.appendChild(d);const l=document.createElement("p"),p=Object.assign(document.createElement("input"),{type:"number",min:0,max:300,defaultValue:0,id:"recordOptionDelayInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:c("start-delay")});l.appendChild(m),l.appendChild(p),n.appendChild(l);const u=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),b=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),h=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:c("record-audio"),title:c("record-audio-description")});u.appendChild(b),u.appendChild(h),n.appendChild(u);const g=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),O=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),C=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:c("record-mic")});g.appendChild(O),g.appendChild(C),n.appendChild(g);const E=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),f=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),w=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:c("record-after-flag")});E.appendChild(f),E.appendChild(w),n.appendChild(E);const v=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),x=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),k=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:c("record-until-stop")});f.addEventListener("change",()=>{(x.disabled=!f.checked)&&(k.title=c("record-until-stop-disabled",{afterFlagOption:c("record-after-flag")}))}),v.appendChild(x),v.appendChild(k),n.appendChild(v);let j=null;const y=new Promise(e=>{j=e});let R=null;e.addEventListener("click",()=>R(null)),o.addEventListener("click",()=>R(null)),R=e=>{j(e),a()};const P=Object.assign(document.createElement("div"),{className:r.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),S=Object.assign(document.createElement("button"),{textContent:c("cancel")});S.addEventListener("click",()=>R(null),{once:!0}),P.appendChild(S);const T=Object.assign(document.createElement("button"),{textContent:c("start"),className:r.tab.scratchClass("prompt_ok-button")});return T.addEventListener("click",()=>R({secs:Number(i.value),delay:Number(p.value),audioEnabled:b.checked,micEnabled:O.checked,waitUntilFlag:f.checked,useStopSign:!x.disabled&&x.checked}),{once:!0}),P.appendChild(T),n.appendChild(P),y},h=()=>{i=!1,t.textContent=c("record"),t.title="",n=null,u=[],clearTimeout(a),a=0,m&&(r.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",m),m=null)},g=e=>{if(s)return r.tab.traps.vm.runtime.off("PROJECT_START",l),s=!1,l=null,p.abort(),p=null,void h();i&&n&&"inactive"!==n.state&&(e?h():(n.onstop=()=>{const e=new Blob(u,{type:"video/webm"});Object(o.default)("video.webm",e),h()},n.stop()))},O=async e=>{const o=Math.min(300,Math.max(1,e.secs));u=[],i=!0;const b=r.tab.traps.vm;let h;if(e.micEnabled)try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(t){if("NotAllowedError"!==t.name&&"NotFoundError"!==t.name)throw t;e.micEnabled=!1}if(e.waitUntilFlag){s=!0,Object.assign(t,{textContent:c("click-flag"),title:c("click-flag-description")}),p=new AbortController;try{await Promise.race([new Promise(e=>{l=()=>e(),b.runtime.once("PROJECT_START",l)}),new Promise((e,t)=>{p.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}s=!1,l=p=null;const O=new MediaStream,C=b.runtime.renderer.canvas.captureStream();O.addTrack(C.getVideoTracks()[0]);const E=new AudioContext,f=E.createMediaStreamDestination();if(e.audioEnabled){const e=b.runtime.audioEngine.audioContext.createMediaStreamDestination();b.runtime.audioEngine.inputNode.connect(e),E.createMediaStreamSource(e.stream).connect(f)}e.micEnabled&&E.createMediaStreamSource(h).connect(f),(e.audioEnabled||e.micEnabled)&&O.addTrack(f.stream.getAudioTracks()[0]),n=new MediaRecorder(O,{mimeType:"video/webm"}),n.ondataavailable=e=>{u.push(e.data)},n.onerror=e=>{d.warn("Recorder error:",e.error),g(!0)},a=setTimeout(()=>g(!1),1e3*o),e.useStopSign&&(m=()=>g(),b.runtime.once("PROJECT_STOP_ALL",m));const w=e.delay||0,v=Math.floor(w);for(let e=0;e<v;e++)t.textContent=c("starting-in",{secs:v-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{t.textContent=c("stop"),n.start(1e3)},1e3*(w-v))};t||(t=Object.assign(document.createElement("div"),{className:"sa-record "+e.className,textContent:c("record")}),t.addEventListener("click",async()=>{if(i)g();else{const e=await b();if(!e)return void d.log("Canceled");O(e)}})),e.parentElement.appendChild(t)}}},"./src/addons/libraries/common/cs/download-blob.js":function(e,t,n){"use strict";n.r(t),t.default=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const o=window.URL.createObjectURL(t);n.href=o,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(o)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}}}]);
//# sourceMappingURL=addon-entry-mediarecorder.js.map
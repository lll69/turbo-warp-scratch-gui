/*! For license information please see addon-entry-swap-local-global.js.LICENSE */
(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([["addon-entry-swap-local-global"],{"./node_modules/css-loader/index.js!./src/addons/addons/swap-local-global/style.css":function(e,t,a){(e.exports=a("./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,".sa-swap-local-global-hint {\n  padding-bottom: 1rem;\n}\n.sa-swap-local-global-stage {\n  /* resolves scratch class style conflict */\n  display: block;\n}\n",""])},"./src/addons/addons/swap-local-global/_runtime_entry.js":function(e,t,a){"use strict";a.r(t),a.d(t,"resources",(function(){return o}));var s=a("./src/addons/addons/swap-local-global/userscript.js"),l=a("./node_modules/css-loader/index.js!./src/addons/addons/swap-local-global/style.css"),n=a.n(l);const o={"userscript.js":s.default,"style.css":n.a}},"./src/addons/addons/swap-local-global/userscript.js":function(e,t,a){"use strict";a.r(t),t.default=async function(e){let{addon:t,msg:a,console:s}=e;const l=await t.tab.traps.getBlockly(),n=t.tab.traps.vm,o=e=>e.isStage?l.ScratchMsgs.translate("SENSING_OF_STAGE","Stage"):e.getName(),i=e=>n.editingTarget.lookupVariableById(e),r=()=>n.editingTarget.isStage,c=(e,t)=>{"string"==typeof t&&(t=e.getVariableById(t)),e.variableMap_.deleteVariable(t)};let d=null;const p=()=>{d&&(d(),d=null)},u=function(e){const t=this.getEventWorkspace_();e?(d=m(t,this.varId),c(t,this.varId)):(t.createVariable(this.varName,this.varType,this.varId,this.isLocal,this.isCloud),p())},g=function(e){const t=this.getEventWorkspace_();e?(t.createVariable(this.varName,this.varType,this.varId,this.isLocal,this.isCloud),p()):(d=m(t,this.varId),c(t,this.varId))},b=()=>l.Events.fireNow_(),m=(e,t)=>{const a=n.runtime._monitorState.get(t),s=i(t);return()=>{b();const l=i(t);if(l&&(l.value=s.value),a){a.visible&&n.runtime.monitorBlocks.changeBlock({id:t,element:"checkbox",value:!0});const e=!n.runtime.getTargetForStage().variables[t];let o=a;if(e){const e=n.editingTarget;o=o.set("targetId",e.id),o=o.set("spriteName",e.getName())}else o=o.set("targetId",null),o=o.set("spriteName",null);if(l.name!==s.name){const e=n.runtime.monitorBlocks,a=e.getBlock(t);a&&(o=o.set("params",e._getBlockParams(a)))}n.runtime.requestAddMonitor(o)}l.name!==s.name&&((e,t)=>{const a=e.getVariableById(t);for(const t of e.getAllBlocks())t.updateVarName(a)})(e,t)}},h=(e,t,s)=>{const i=e.name,d=e.getId(),p=e.type,h=e.isLocal,v=e.isCloud;if(h===t&&v===s)return;if(s&&t)return void alert(a("cant-convert-cloud"));const f=n.editingTarget;if(h!==t)if(t){if(r())return void alert(a("cant-convert-stage"));const e=(e=>n.runtime.targets.filter(e=>e.isOriginal).filter(t=>Object.values(t.blocks._blocks).find(t=>t.fields.LIST&&t.fields.LIST.id===e||t.fields.VARIABLE&&t.fields.VARIABLE.id===e)))(d);if(!e.every(e=>e===f))return void(e.length>1?alert(a("cant-convert-to-local",{sprites:e.map(o).join(", ")})):alert(a("cant-convert-used-elsewhere",{sprite:o(e[0])})))}else{const e=((e,t)=>n.runtime.targets.filter(a=>a.isOriginal&&a.lookupVariableByNameAndType(e,t,!0)))(i,p).filter(e=>e!==f);if(e.length>0)return void alert(a("cant-convert-conflict",{sprites:e.map(o).join(", ")}))}let y=i;v!==s&&(s?y="☁ "+i:i.startsWith("☁ ")&&(y=i.replace("☁ ","")));const k=e.workspace,C=m(k,d);l.Events.setGroup(!0);try{c(k,e),k.createVariable(y,p,d,t,s)}finally{l.Events.setGroup(!1)}b();const _=k.undoStack_,E=_[_.length-1],S=_[_.length-2];E instanceof l.Events.VarCreate&&S instanceof l.Events.VarDelete&&(E.run=g,S.run=u),C()},v=l.Variables.renameVariable;l.Variables.renameVariable=function(e,s,l){const o=v.call(this,e,s,(function(){l&&l(...arguments),!t.self.disabled&&i&&h(s,i.isLocal(),i.isCloud())})),i=(e=>{if(t.self.disabled)return;const s=document.querySelector('[class^="prompt_body_"]');if(!s)return;const l=s.parentElement.querySelector('[class^="modal_header-item_"]');l&&(""===e.type?l.textContent=a("edit-variable-header"):l.textContent=a("edit-list-header"));const o=document.createElement("div");t.tab.displayNoneWhileDisabled(o);const i=(e,t)=>{const a=document.createElement("label"),s=document.createElement("input");"checkbox"===t?s.type="checkbox":(s.name="variableScopeOption",s.type="radio",s.value=t),a.appendChild(s);const l=document.createElement("span");return l.textContent=e,a.appendChild(l),{outer:a,label:l,input:s}},c=t.tab.scratchClass("prompt_disabled-label"),d=document.createElement("div");d.className=t.tab.scratchClass("prompt_info-message","prompt_cloud-option",{others:"sa-swap-local-global-stage"}),d.appendChild(Object.assign(document.createElement("span"),{textContent:t.tab.scratchMessage("gui.gui.variablePromptAllSpritesMessage")}));const p=document.createElement("div");p.className=t.tab.scratchClass("prompt_options-row","prompt_cloud-option");const u=i(t.tab.scratchMessage("gui.gui.variableScopeOptionAllSprites"),"global"),g=i(t.tab.scratchMessage("gui.gui.variableScopeOptionSpriteOnly"),"local");u.input.checked=!e.isLocal,g.input.checked=e.isLocal,p.appendChild(u.outer),p.appendChild(g.outer);const b=document.createElement("div");b.className=t.tab.scratchClass("prompt_cloud-option");const m=i(t.tab.scratchMessage("gui.gui.cloudVariableOption"),"checkbox");m.input.checked=e.isCloud,n.runtime.canAddCloudVariable()||e.isCloud||(m.input.disabled=!0,b.classList.add(c)),b.appendChild(m.outer);const h=()=>{const e=m.input.checked;g.input.disabled=e,g.label.classList.toggle(c,e),e&&u.input.click()};m.input.addEventListener("change",h),h();let v=!1;return r()?o.appendChild(d):(v=!0,o.appendChild(p)),""===e.type&&(()=>{const e=document.querySelector('[class^="gui_blocks-wrapper_"]');let a=e[t.tab.traps.getInternalKey(e)];for(;;){var s,l;if(!a)return!1;const e=null===(s=a.stateNode)||void 0===s||null===(l=s.props)||void 0===l?void 0:l.canUseCloud;if("boolean"==typeof e)return e;a=a.child}})()&&(v=!0,o.appendChild(b)),v&&o.prepend(Object.assign(document.createElement("div"),{textContent:a("edit"),className:"sa-swap-local-global-hint"})),s.insertBefore(o,s.lastChild),{isLocal:()=>g.input.checked,isCloud:()=>m.input.checked}})(s);return o},t.tab.createBlockContextMenu((e,s)=>{if(!t.self.disabled&&("data"===s.getCategory()||"data-lists"===s.getCategory())){const t=s.workspace.getVariableById(s.getVars()[0]);t&&(e.length>0&&(e[0].text===l.ScratchMsgs.translate("RENAME_VARIABLE")?e[0].text=a("edit-variable-option"):e[0].text===l.ScratchMsgs.translate("RENAME_LIST")&&(e[0].text=a("edit-list-option"))),e.push({enabled:!0,separator:!0,text:a("to-".concat(t.isLocal?"global":"local")),callback:()=>h(t,!t.isLocal,t.isCloud)}))}return e},{flyout:!0,blocks:!0})}}}]);
//# sourceMappingURL=addon-entry-swap-local-global.js.map